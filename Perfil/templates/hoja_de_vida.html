<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <style>
        /* Configuraciones para xhtml2pdf */
        @page { size: A4; margin: 1.5cm; }
        body { font-family: Helvetica, sans-serif; color: #333; line-height: 1.4; font-size: 10pt; }
        
        /* Encabezado estilo CV */
        .header { width: 100%; border-bottom: 2px solid #2c3e50; padding-bottom: 10px; margin-bottom: 20px; }
        .name { font-size: 22pt; font-weight: bold; text-transform: uppercase; color: #2c3e50; }
        .contact-info { font-size: 9pt; color: #555; }
        .foto-perfil { width: 100px; height: 100px; }

        /* Títulos de sección */
        h2 { background-color: #f1f3f5; color: #2c3e50; padding: 5px; font-size: 12pt; border-left: 5px solid #2c3e50; text-transform: uppercase; margin-top: 15px; }
        
        /* Items de contenido */
        .item { margin-bottom: 10px; }
        .item-title { font-weight: bold; font-size: 11pt; color: #000; }
        .item-subtitle { font-weight: bold; color: #444; font-size: 10pt; }
        .date { color: #666; font-style: italic; font-size: 9pt; }
        
        /* Manejo de imágenes de certificados (Para que salgan dentro del HTML si son fotos) */
        .cert-container { margin-top: 10px; text-align: center; }
        .cert-img { width: 60%; border: 1px solid #ddd; padding: 5px; }
        
        /* Tablas de datos personales */
        .data-table { width: 100%; margin-bottom: 10px; }
        .label { font-weight: bold; width: 30%; }
    </style>
</head>
<body>

    <table class="header">
        <tr>
            <td width="75%">
                <div class="name">{{ perfil.nombres }} {{ perfil.apellidos }}</div>
                <div class="contact-info">
                    ID: {{ perfil.numerocedula }} | {{ perfil.nacionalidad }}<br>
                    Tel: {{ perfil.telefonofijo }} / {{ perfil.telefonoconvencional }}<br>
                    {{ perfil.direcciondomiciliaria }}<br>
                    {{ perfil.sitioweb|default:"" }}
                </div>
            </td>
            <td width="25%" style="text-align: right;">
                {% if perfil.foto %}
                    <img src="{{ perfil.foto.url }}" class="foto-perfil">
                {% endif %}
            </td>
        </tr>
    </table>

    <h2>Experiencia Laboral</h2>
    {% for exp in items %} <div class="item">
        <div class="item-title">{{ exp.cargodesempenado }}</div>
        <div class="item-subtitle">{{ exp.nombrempresa }} — {{ exp.lugarempresa }}</div>
        <div class="date">{{ exp.fechainiciogestion|date:"d/m/Y" }} - {% if exp.fechafingestion %}{{ exp.fechafingestion|date:"d/m/Y" }}{% else %}Actualidad{% endif %}</div>
        <p>{{ exp.descripcionfunciones }}</p>
    </div>
    {% empty %}
    <p>No hay experiencia registrada.</p>
    {% endfor %}

    <h2>Cursos y Formación</h2>
    {% for curso in cursos %}
    <div class="item">
        <div class="item-title">{{ curso.nombrecurso }}</div>
        <div class="item-subtitle">{{ curso.entidadpatrocinadora }} ({{ curso.totalhoras }} horas)</div>
        <div class="date">Finalizado el: {{ curso.fechafin|date:"d/m/Y" }}</div>
        {% if curso.rutacertificado and not curso.rutacertificado.url|lower|slice:"-4:" == ".pdf" %}
        <div class="cert-container">
            <img src="{{ curso.rutacertificado.url }}" class="cert-img">
        </div>
        {% endif %}
    </div>
    {% endfor %}

    <h2>Reconocimientos</h2>
    {% for rec in reconocimientos %}
    <div class="item">
        <div class="item-title">{{ rec.tiporeconocimiento }}</div>
        <div class="item-subtitle">{{ rec.entidadpatrocinadora }}</div>
        <div class="date">Fecha: {{ rec.fechareconocimiento|date:"d/m/Y" }}</div>
        <p>{{ rec.descripcionreconocimiento }}</p>
        {% if rec.rutacertificado and not rec.rutacertificado.url|lower|slice:"-4:" == ".pdf" %}
        <div class="cert-container">
            <img src="{{ rec.rutacertificado.url }}" class="cert-img">
        </div>
        {% endif %}
    </div>
    {% endfor %}

    <h2>Productos Académicos y Laborales</h2>
    {% for prod in productos %}
    <div class="item">
        <strong>{{ prod.nombrerecurso }}</strong> ({{ prod.clasificador }}): {{ prod.descripcion }}
    </div>
    {% endfor %}
    
    {% for pl in productos_laborales %}
    <div class="item">
        <strong>{{ pl.nombreproducto }}</strong> ({{ pl.fechaproducto|date:"Y" }}): {{ pl.descripcion }}
    </div>
    {% endfor %}

</body>
</html>